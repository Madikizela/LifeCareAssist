@page
@model PatientsIndexModel
@{
    ViewData["Title"] = "Patients";
}

<div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold">Patients</h1>
    <a href="/patients/create" class="btn btn-primary">+ Add New Patient</a>
</div>

<div class="card mb-6">
    <form method="get" class="flex gap-4">
        <input type="text" name="search" value="@Model.SearchTerm" placeholder="Search by name, ID number, or phone..." class="input flex-1" />
        <button type="submit" class="btn btn-primary">Search</button>
    </form>
</div>

<div class="card">
    <div class="overflow-x-auto">
        <table class="w-full">
            <thead class="bg-gray-50 border-b">
                <tr>
                    <th class="px-4 py-3 text-left">Name</th>
                    <th class="px-4 py-3 text-left">ID Number</th>
                    <th class="px-4 py-3 text-left">Phone</th>
                    <th class="px-4 py-3 text-left">Language</th>
                    <th class="px-4 py-3 text-left">Chronic Conditions</th>
                    <th class="px-4 py-3 text-left">Actions</th>
                </tr>
            </thead>
            <tbody class="divide-y">
                @foreach (var patient in Model.Patients)
                {
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-3">@patient.FirstName @patient.LastName</td>
                        <td class="px-4 py-3">@patient.IdNumber</td>
                        <td class="px-4 py-3">@patient.IdNumber</td>
                        <td class="px-4 py-3">@patient.PhoneNumber</td>
                        <td class="px-4 py-3">
                            <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-sm">
                                @patient.PreferredLanguage.ToUpper()
                            </span>
                        </td>
                        <td class="px-4 py-3">
                            @if (patient.ChronicConditions.Any())
                            {
                                <span class="text-sm">@string.Join(", ", patient.ChronicConditions)</span>
                            }
                            else
                            {
                                <span class="text-gray-400">None</span>
                            }
                        </td>
                        <td class="px-4 py-3">
                            <div class="flex gap-2">
                                <a href="/patients/details?id=@patient.Id" class="text-blue-600 hover:underline">View</a>
                                <a href="/patients/edit?id=@patient.Id" class="text-green-600 hover:underline">Edit</a>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<div class="flex items-center justify-between mt-4">
    <div class="text-sm text-gray-600">Showing @Model.Patients.Count of @Model.TotalCount</div>
    <div class="flex gap-2">
        @{
            var prevPage = Model.Page > 1 ? Model.Page - 1 : 1;
            var nextPage = (Model.Page * Model.PageSize) < Model.TotalCount ? Model.Page + 1 : Model.Page;
        }
        <a class="btn bg-gray-200 hover:bg-gray-300" href="/patients?search=@Model.SearchTerm&page=@prevPage&pageSize=@Model.PageSize">Prev</a>
        <a class="btn bg-gray-200 hover:bg-gray-300" href="/patients?search=@Model.SearchTerm&page=@nextPage&pageSize=@Model.PageSize">Next</a>
    </div>
</div>
